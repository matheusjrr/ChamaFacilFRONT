<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Central de SoluÃ§Ãµes</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />

    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Ãcones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS local -->
    <link rel="stylesheet" href="../css/faq.css" />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body>

    <!-- HEADER -->
    <header class="site-header">
      <div class="header-inner">

        <div class="brand">
          <div class="logo-wrapper">
            <img src="../assets/logo.png" alt="Logo Chama FÃ¡cil" class="brand-logo">
          </div>
          <span class="brand-title">Chama FÃ¡cil</span>
        </div>

        <!-- Menu superior -->
        <nav class="main-nav" aria-label="Menu principal">
          <a class="nav-link active" href="faq.html">Central de SoluÃ§Ãµes</a>
          <a class="nav-link" href="artigos.html">Artigos & Documentos</a>
        </nav>

        <div class="profile-area" title="Perfil">
          <i class="fa-solid fa-user-circle"></i>
        </div>

      </div>
    </header>

    <div class="layout">

      <!-- SIDEBAR -->
      <aside class="sidebar">
        <ul>
          <li>
            <a href="atividades.html">
              <i class="fa-solid fa-list-check"></i> Minhas Atividades
            </a>
          </li>

          <li>
            <a href="chamados.html">
              <i class="fa-solid fa-headset"></i> Chamados
            </a>
          </li>

          <li>
            <a href="perfil.html">
              <i class="fa-solid fa-user"></i> Perfil
            </a>
          </li>

          <li>
            <a href="#" onclick="abrirModalSaida()">
              <i class="fa-solid fa-clipboard-list"></i> Sair
            </a>
          </li>
        </ul>
      </aside>

      <!-- CONTEÃšDO PRINCIPAL -->
      <main class="page">

        <section class="hero-card">
          <h1 class="hero-title">Central de SoluÃ§Ãµes</h1>

          <div class="search-area">
            <label class="search-label">
              <input id="searchInput" type="search" placeholder="Pesquise aqui..." aria-label="Pesquisar dÃºvidas" />
              <i class="fa-solid fa-magnifying-glass search-icon"></i>
            </label>

            <a href="chamados.html" class="btn-chamado">Abrir novo chamado</a>
          </div>

          <!-- CARDS -->
          <div class="category-cards">

            <a href="#" class="cat-card-link" data-topic="estou com problemas de acesso, travamentos ou falhas no sistema.">
              <article class="cat-card">
                <div class="cat-icon"><i class="fa-solid fa-desktop"></i></div>
                <h3>Sistema e Login</h3>
                <p>Problemas de acesso, travamentos ou falhas no sistema.</p>
                <div class="card-footer">Clique para saber mais <i class="fa-solid fa-arrow-right"></i></div>
              </article>
            </a>

            <a href="#" class="cat-card-link" data-topic="estou com problemas gerais como erros tÃ©cnicos, lentidÃ£o e falhas de rede.">
              <article class="cat-card">
                <div class="cat-icon"><i class="fa-solid fa-wrench"></i></div>
                <h3>Problemas Gerais</h3>
                <p>Erros tÃ©cnicos, lentidÃ£o e falhas de rede.</p>
                <div class="card-footer">Clique para saber mais <i class="fa-solid fa-arrow-right"></i></div>
              </article>
            </a>

            <a href="#" class="cat-card-link" data-topic="estou com dÃºvidas de como abrir, acompanhar e resolver chamados de suporte.">
              <article class="cat-card">
                <div class="cat-icon"><i class="fa-solid fa-gear"></i></div>
                <h3>Chamados e Suporte</h3>
                <p>Como abrir, acompanhar e resolver chamados de suporte.</p>
                <div class="card-footer">Clique para saber mais <i class="fa-solid fa-arrow-right"></i></div>
              </article>
            </a>

          </div>
        </section>

        <section class="faq-section" aria-labelledby="faqTitle">
          <h2 id="faqTitle">Perguntas frequentes</h2>
          <div id="faqList" class="faq-list"></div>
        </section>

      </main>
    </div>

    <!-- botÃ£o flutuante -->
    <button
      id="chatToggle"
      class="fixed bottom-6 right-6 bg-[#3B82F6] text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:bg-[#1E40AF] transition z-50">
      ðŸ’¬
    </button>

    <!-- modal do chat -->
    <div
      id="chatModal"
      class="hidden fixed bottom-20 right-6 w-[380px] max-w-[90%] bg-white rounded-2xl shadow-xl flex flex-col overflow-hidden border border-gray-200 z-50">

      <!-- header -->
      <header class="flex items-center justify-between bg-[#2F374C] text-white p-3">

        <div class="flex items-center gap-3">
          <img src="../assets/zehelp.png" class="w-9 h-9 rounded-full bg-white p-1" alt="ZÃ© Help">
          <div>
            <h1 class="text-sm font-semibold leading-none">ZÃ© Help</h1>
            <p class="text-xs opacity-80">Ajudante do Chama FÃ¡cil</p>
          </div>
        </div>

        <button id="closeChat" class="text-lg font-bold hover:text-red-400 transition">Ã—</button>

      </header>

      <!-- mensagens -->
      <main id="chatBox" class="flex-1 p-3 overflow-y-auto bg-gray-50 space-y-3">

        <div class="msg flex items-end gap-2">
          <img src="../assets/zehelp.png" class="w-7 h-7 rounded-full" alt="ZÃ© Help">
          <div class="bg-[#3B82F6] text-white px-3 py-2 rounded-2xl max-w-[75%] text-sm">
            Oi! Sou o ZÃ© Help ðŸ˜„ Como posso te ajudar hoje?
          </div>
        </div>

      </main>

      <!-- input -->
      <div class="flex items-center gap-2 border-t border-gray-200 p-2 bg-white">
        <input
          id="userInput"
          type="text"
          placeholder="Digite sua mensagem..."
          class="flex-1 border border-gray-300 rounded-full px-3 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-[#3B82F6]">

        <button
          id="sendBtn"
          class="bg-[#3B82F6] text-white px-4 py-1.5 rounded-full text-sm hover:bg-[#1E40AF] transition">
          Enviar
        </button>
      </div>

    </div>

    <!-- MODAL DE CONFIRMAÃ‡ÃƒO DE SAÃDA -->
    <div id="modalConfirm" class="modal">
      <div class="modal-content text-center">
        <h2 class="text-lg font-semibold mb-4 text-gray-800">Tem certeza que deseja sair?</h2>

        <div class="flex justify-center gap-4">
          <button id="btnConfirmarSair" class="bg-[var(--error)] text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">
            Sair
          </button>

          <button id="btnCancelarSair" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition">
            Cancelar
          </button>
        </div>

      </div>
    </div>

    <footer class="site-footer">
      <div>Â© 2025 Chama FÃ¡cil â€” suporte: chamafacil@outlook.com</div>
    </footer>


    <script>
      const navLinks = document.querySelectorAll('.main-nav .nav-link');
      const currentPage = window.location.pathname.split('/').pop();

      const chatToggle = document.getElementById('chatToggle');
      const chatModal = document.getElementById('chatModal');
      const closeChat = document.getElementById('closeChat');
      const chatBox = document.getElementById('chatBox');
      const userInput = document.getElementById('userInput');
      const sendBtn = document.getElementById('sendBtn');

      const modalConfirm = document.getElementById('modalConfirm');
      const btnConfirmarSair = document.getElementById('btnConfirmarSair');
      const btnCancelarSair = document.getElementById('btnCancelarSair');

      // ==================== CHATBOT VIA CARD ==================== //
      const cardLinks = document.querySelectorAll('.cat-card-link');
      const sendBtnCard = document.getElementById('sendBtn');
      const userInputCard = document.getElementById('userInput');

      cardLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();

          const topic = link.getAttribute('data-topic');
          chatModal.classList.remove('hidden');

          const mensagemInicial = `Oi! Preciso de ajuda ${topic}`;

          addMessage(mensagemInicial, 'user');

          userInputCard.value = mensagemInicial;
          sendBtnCard.click();
        });
      });

      navLinks.forEach(link => {
        if (link.getAttribute('href') === currentPage) {
          link.classList.add('active');
        }
      });

      chatToggle.addEventListener('click', () => {
        chatModal.classList.toggle('hidden');
      });

      closeChat.addEventListener('click', () => {
        chatModal.classList.add('hidden');
      });

      function addMessage(text, sender) {
        const msg = document.createElement('div');
        msg.className = 'msg flex items-end gap-2';

        msg.innerHTML = sender === 'user'
          ? `<div class='ml-auto bg-gray-200 text-gray-800 px-3 py-2 rounded-2xl max-w-[75%] text-sm'>${text}</div>`
          : `<img src='../assets/zehelp.png' class='w-7 h-7 rounded-full'>
             <div class='bg-[#3B82F6] text-white px-3 py-2 rounded-2xl max-w-[75%] text-sm'>${text}</div>`;

        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function showTypingIndicator() {
        const typingDiv = document.createElement('div');
        typingDiv.id = 'typingIndicator';
        typingDiv.className = 'msg flex items-end gap-2';
        typingDiv.innerHTML = `
              <img src='../assets/zehelp.png' class='w-7 h-7 rounded-full'>
              <div class='bg-[#3B82F6] text-white px-3 py-2 rounded-2xl text-sm'>digitando...</div>`;
        chatBox.appendChild(typingDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function removeTypingIndicator() {
        const typingDiv = document.getElementById('typingIndicator');
        if (typingDiv) typingDiv.remove();
      }

      sendBtn.addEventListener('click', () => {
        const text = userInput.value.trim();
        if (!text || sendBtn.disabled) return;

        addMessage(text, 'user');
        userInput.value = '';
        sendBtn.disabled = true;
        userInput.disabled = true;

        showTypingIndicator();

        fetch('https://localhost:7271/api/ia/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message: text,
            sessionId: 'usuario-chat'
          })
        })
          .then(res => res.json())
          .then(data => {
            removeTypingIndicator();
            addMessage(data.response || 'Desculpe, nÃ£o entendi sua mensagem.', 'bot');
          })
          .catch(() => {
            removeTypingIndicator();
            addMessage('Ops! Algo deu errado ao falar com o assistente. ðŸ˜¢', 'bot');
          })
          .finally(() => {
            sendBtn.disabled = false;
            userInput.disabled = false;
            userInput.focus();
          });
      });

      userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendBtn.click();
      });

      function abrirModalSaida() {
        modalConfirm.style.display = 'flex';
      }

      function fecharModalSaida() {
        modalConfirm.style.display = 'none';
      }

      btnConfirmarSair.addEventListener('click', () => {
        window.location.href = 'home.html';
      });

      btnCancelarSair.addEventListener('click', fecharModalSaida);

      window.addEventListener('click', (e) => {
        if (e.target === modalConfirm) fecharModalSaida();
      });
    </script>

    <script src="../js/faq.js"></script>

  </body>
</html>